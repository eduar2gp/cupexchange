<div class="dashboard-container">
  <mat-toolbar class="dashboard-header">
    <div class="header-content">
      <h2>Products ({{ filteredProducts().length }})</h2>

      <form [formGroup]="searchForm" class="filter-form">
        <div class="controls-row">
          <mat-form-field appearance="outline" class="compact-select">
            <mat-label>Province</mat-label>
            <mat-select formControlName="provinceId">
              <mat-option *ngFor="let prov of provinces" [value]="prov.id">{{ prov.name }}</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline" class="compact-select">
            <mat-label>Muni</mat-label> <mat-select formControlName="municipalityId">
              <mat-option *ngFor="let muni of filteredMunicipalities" [value]="muni.id">{{ muni.name }}</mat-option>
            </mat-select>
          </mat-form-field>

          <button mat-mini-fab color="primary" (click)="performSearch()" type="submit">
            <mat-icon>search</mat-icon>
          </button>
        </div>
      </form>
    </div>
  </mat-toolbar>

  @if (filteredProducts().length > 0) {
  <div class="product-grid">
    @for (product of filteredProducts(); track product.id) {
    <mat-card class="product-card" [class.not-available]="!product.available">
      <div class="image-container">
        <img mat-card-image [src]="product.productImageUrl || 'assets/placeholder.png'" [alt]="product.name">
        @if (!product.available) {
        <div class="availability-overlay">Not available in your area</div>
        }
      </div>

      <mat-card-content>
        <h3 class="product-name">{{ product.name }}</h3>
        <p class="product-price">{{ product.price | currency }}</p>
        <p class="product-description">{{ product.description | slice:0:60 }}...</p>
      </mat-card-content>

      <mat-card-actions>
        <button mat-flat-button color="primary" (click)="addProduct(product)" [disabled]="!product.available">
          <mat-icon>shopping_cart</mat-icon>
          {{ product.available ? 'ADD TO CART' : 'OUT OF REACH' }}
        </button>
      </mat-card-actions>
    </mat-card>
    }
  </div>
  } @else {
  <div class="empty-state">
    <mat-icon>search_off</mat-icon>
    <p>No products found matching filters</p>
  </div>
  }
</div>
