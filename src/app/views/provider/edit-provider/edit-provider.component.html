<div class="edit-provider-container">

  @if (providerData$ | async; as provider) {
  <mat-card class="main-card">
    <mat-card-header>
      <mat-card-title>Provider Settings</mat-card-title>
      <mat-card-subtitle>Update your public profile and contact info</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <form #productForm="ngForm" (ngSubmit)="saveChanges(provider)" class="provider-form">
        <div class="form-row">
          <div class="image-upload-section">
            <div class="preview-container">
              <img [src]="provider.profileImageUrl" class="profile-preview" />
              <button type="button" mat-mini-fab color="primary" class="upload-btn" (click)="fileInput.click()">
                <mat-icon>photo_camera</mat-icon>
              </button>
            </div>
            <input type="file" hidden (change)="onFileSelected($event)" accept="image/*" #fileInput>
            <p class="mat-caption">Profile Image</p>
          </div>

          <div class="fields-column">
            <mat-form-field appearance="outline">
              <mat-label>Business Name</mat-label>
              <input matInput name="name" [(ngModel)]="provider.name" required>
              <mat-icon matSuffix>business</mat-icon>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Email Address</mat-label>
              <input matInput type="email" name="email" [(ngModel)]="provider.email" required>
              <mat-icon matSuffix>email</mat-icon>
            </mat-form-field>
          </div>
        </div>

        <div class="actions-row">
          <button mat-flat-button color="primary" type="submit" [disabled]="productForm.invalid">
            <mat-icon>save</mat-icon> Save Changes
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
  }

  <div class="product-header">
    <h2>Catalog Management</h2>
    <button mat-raised-button color="accent" (click)="addProduct()">
      <mat-icon>add</mat-icon> Add New Product
    </button>
  </div>

  <div class="product-grid">
    @for (product of productsList(); track product.id) {
    <mat-card class="product-card" appearance="outlined">
      <img mat-card-image [src]="product.productImageUrl" [alt]="product.name" class="product-img">

      <mat-card-content>
        <div class="product-info">
          <h3 class="product-title">{{product.name}}</h3>
          <span class="product-price">{{product.price | currency}}</span>
        </div>
        <p class="product-desc">{{product.description}}</p>
      </mat-card-content>

      <mat-card-actions align="end">
        <button mat-icon-button color="warn" (click)="deleteProduct(product.id!)" matTooltip="Delete">
          <mat-icon>delete</mat-icon>
        </button>
        <button mat-icon-button color="primary" (click)="editProduct(product)" matTooltip="Edit">
          <mat-icon>edit</mat-icon>
        </button>
      </mat-card-actions>
    </mat-card>
    } @empty {
    <div class="empty-state">
      <mat-icon>inventory_2</mat-icon>
      <p>No products found in your catalog.</p>
    </div>
    }
  </div>
</div>
