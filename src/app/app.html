<mat-sidenav-container fullscreen>
  <!-- Left sidenav -->
  <mat-sidenav #sidenav mode="over" opened="false" position="start">
    <div class="menu-header">
      <h3>Menu</h3>
    </div>
    <mat-nav-list>
      @if (authService.isAuthenticated()) {
      <a *appHasRole="[Role.Admin]" mat-list-item routerLink="/providers-list">
        <mat-icon matListItemIcon>store</mat-icon>
        <span matListItemTitle>{{ 'PROVIDERS' | translate }}</span>
      </a>
      <a *appHasRole="[Role.Provider]" mat-list-item routerLink="/provider-dashboard">
        <mat-icon matListItemIcon>store</mat-icon>
        <span matListItemTitle>{{ 'MY_STORE' | translate }}</span>
      </a>
      @if ((dataService.isEcommerce$ | async) == false) {
      <a mat-list-item routerLink="/add-order" (click)="checkWalletsAndNavigate()">
        <mat-icon matListItemIcon>add_circle</mat-icon>
        <span matListItemTitle>{{ 'NEW_ORDER' | translate }}</span>
      </a>
      }
      <a mat-list-item routerLink="/profile">
        <mat-icon matListItemIcon>account_box</mat-icon>
        <span matListItemTitle>{{ 'PROFILE' | translate }}</span>
      </a>
      <a mat-list-item routerLink="/wallet">
        <mat-icon matListItemIcon>account_balance_wallet</mat-icon>
        <span matListItemTitle>{{ 'WALLETS' | translate }}</span>
      </a>
      <a mat-list-item routerLink="/settings">
        <mat-icon matListItemIcon>settings</mat-icon>
        <span matListItemTitle>{{ 'SETTINGS' | translate }}</span>
      </a>
      <a mat-list-item (click)="handleLogout()">
        <mat-icon matListItemIcon>logout</mat-icon>
        <span matListItemTitle>{{ 'LOGOUT' | translate }}</span>
      </a>
      }
    </mat-nav-list>
  </mat-sidenav>
  <!-- Main content -->
  <mat-sidenav-content class="sidenav-content">
    @if (authService.isAuthenticated()) {
    <!-- Top toolbar -->
    <mat-toolbar class="app-toolbar">
      <div class="toolbar-left-controls">
        <button mat-icon-button (click)="sidenav.toggle()">
          <mat-icon>menu</mat-icon>
        </button>        
      </div>

      @if (dataService.isEcommerce$ | async; as isEco) {
      <mat-form-field appearance="outline" class="search-input">
        <mat-label>Search Products</mat-label>
        <input matInput (input)="onSearchChange($event)">
        <mat-icon matPrefix>search</mat-icon>
      </mat-form-field>
      } @else {
      <mat-form-field appearance="outline" class="pair-selector">
        <mat-label>{{ 'TRADE' | translate }}</mat-label>
        <mat-select [ngModel]="selectedPair"
                    (ngModelChange)="onPairSelect($event)"
                    [ngModelOptions]="{standalone: true}">
          @for (pair of availablePairs; track pair) {
          <mat-option [value]="pair" class="pair-option">
            <span class="pair-option-content">
              <img [src]="getBaseCurrencyImage(pair.value)" class="pair-logo">
              <span class="pair-text">{{ formatPairDisplay(pair.value) }}</span>
              <img [src]="getQuoteCurrencyImage(pair.value)" class="pair-logo">
            </span>
          </mat-option>
          }
        </mat-select>
        <mat-icon matPrefix>paid</mat-icon>
      </mat-form-field>
      }

      <div class="toolbar-right-controls">
        <span class="toolbar-title">{{ title() }}</span>
        <mat-slide-toggle [checked]="dataService.isEcommerce$ | async"
                          (change)="toggleDashboard($event)"
                          color="primary">          
          <mat-icon>{{ (dataService.isEcommerce$ | async) ? 'autorenew' : 'store' }}</mat-icon>
        </mat-slide-toggle>
      </div>
    </mat-toolbar>
    }
    <!-- Page content -->
    <main class="main-content">
      <router-outlet></router-outlet>
    </main>
    <!-- Bottom navigation (only when authenticated) -->
    @if (authService.isAuthenticated()) {
    <mat-toolbar class="bottom-nav">
      @if (dataService.isEcommerce$ | async; as isEco) {
      <a mat-button routerLink="/ecommerce-dashboard" routerLinkActive="active" class="nav-item">
        <mat-icon>shopping_basket</mat-icon>
        <span matListItemTitle>{{ 'HOME' | translate }}</span>
      </a>
      }@else{
      <a mat-button routerLink="/exchange-dashboard" routerLinkActive="active" class="nav-item">
        <mat-icon>show_chart</mat-icon>
        <span matListItemTitle>{{ 'HOME' | translate }}</span>
      </a>
      }
      <a mat-button routerLink="/wallet" routerLinkActive="active" class="nav-item">
        <mat-icon>account_balance_wallet</mat-icon>
        <span matListItemTitle>{{ 'WALLETS' | translate }}</span>
      </a>
      <a mat-button routerLink="/orders" routerLinkActive="active" class="nav-item">
        <mat-icon>poll</mat-icon>
        <span matListItemTitle>{{ 'ORDERS' | translate }}</span>
      </a>
      @if (dataService.isEcommerce$ | async; as isEco) {
      <a mat-button
         routerLink="/cart"
         routerLinkActive="active"
         class="nav-item"
         matBadge="{{ cartCount$ | async }}"
         matBadgeHidden="{{ (cartCount$ | async) === 0 }}"
         matBadgeColor="warn">
        <mat-icon>add_shopping_cart</mat-icon>
        <span matListItemTitle>{{ 'MY_CART' | translate }}</span>
      </a>
      }@else{
      <a mat-button routerLink="/transactions" routerLinkActive="active" class="nav-item">
        <mat-icon>compare_arrows</mat-icon>
        <span matListItemTitle>{{ 'TRANSACTIONS' | translate }}</span>
      </a>
      }
    </mat-toolbar>
    }
  </mat-sidenav-content>
</mat-sidenav-container>
