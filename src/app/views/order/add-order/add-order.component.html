<div class="trade-page">
  <div class="trade-card">
    <!-- Header -->
    <div class="trade-header">
      <h3 class="trade-title">
        <span class="trade-pair">
          <img [src]="currentPair?.imageUrl"
               [alt]="currentPair?.viewValue"
               class="pair-icon" />
          {{ formatPairDisplay(currentPair?.value) }}
        </span>
      </h3>

      <div class="header-accent"></div>
    </div>

    <!-- Tabs -->
    <mat-tab-group mat-stretch-tabs
                   class="trade-tabs"
                   animationDuration="300ms"
                   (selectedTabChange)="onTabChange($event)">

      <!-- BUY TAB -->
      <mat-tab label="{{ 'BUY' | translate }}">
        <div class="tab-content">
          <form #buyForm="ngForm" (ngSubmit)="saveOrder(buyForm)" class="trade-form">

            <div class="form-grid">
              <!-- Left -->
              <div class="form-column">
                <mat-form-field appearance="fill">
                  <mat-label>{{ 'ORDER_TYPE' | translate }}</mat-label>
                  <mat-select [(ngModel)]="newOrder.type" name="typeBuy" required>
                    @for (type of types; track type.value) {
                    <mat-option [value]="type.value">{{ type.viewValue }}</mat-option>
                    }
                  </mat-select>
                </mat-form-field>

                @if (newOrder.type !== 'MARKET') {
                <div class="price-slider">
                  <label class="price-label">{{ 'PRICE' | translate }}</label>

                  <mat-slider class="slider"
                              [min]="sliderMin"
                              [max]="sliderMax"
                              [step]="sliderStep"
                              thumbLabel
                              discrete
                              [ngClass]="getThemeClass()">
                    <input matSliderThumb
                           [(ngModel)]="newOrder.price"
                           name="priceBuy"
                           required />
                  </mat-slider>

                  <div class="price-display">
                    <span [innerHTML]="formatPriceDisplay(newOrder.price)"></span>
                  </div>
                </div>
                }
              </div>

              <!-- Right -->
              <div class="form-column">
                <mat-form-field appearance="fill">
                  <mat-label>{{ 'AMOUNT' | translate }} ({{ 'VOLUME' | translate }})</mat-label>
                  <input matInput
                         type="text"
                         [ngModel]="volumeInput"
                         (ngModelChange)="onVolumeInput($event)"
                         (blur)="formatVolumeOnBlur()"
                         name="volumeBuy"
                         required
                         placeholder="0.00" />

                  <mat-hint align="end">{{ 'MINIMUN' | translate }}: {{ minVolume | number:'1.2-4' }}</mat-hint>

                  @if (buyForm.controls['volumeBuy']?.hasError('required')) {
                  <mat-error>La cantidad es obligatoria</mat-error>
                  }
                  @if (buyForm.controls['volumeBuy']?.hasError('min')) {
                  <mat-error>{{ 'MINIMUN' | translate }} {{ minVolume }}</mat-error>
                  }
                </mat-form-field>
              </div>
            </div>

            <button type="submit"
                    [disabled]="!buyForm.valid"
                    class="submit-btn submit-buy">
              {{ 'BUY' | translate }} {{ currentPair?.viewValue }}
            </button>

          </form>
        </div>
      </mat-tab>

      <!-- SELL TAB -->
      <mat-tab label="{{ 'SELL' | translate }}">
        <div class="tab-content">
          <form #sellForm="ngForm" (ngSubmit)="saveOrder(sellForm)" class="trade-form">

            <div class="form-grid">
              <!-- Same structure -->
              <div class="form-column">
                <mat-form-field appearance="fill">
                  <mat-label>{{ 'ORDER_TYPE' | translate }}</mat-label>
                  <mat-select [(ngModel)]="newOrder.type" name="typeSell" required>
                    @for (type of types; track type.value) {
                    <mat-option [value]="type.value">{{ type.viewValue }}</mat-option>
                    }
                  </mat-select>
                </mat-form-field>

                @if (newOrder.type !== 'MARKET') {
                <div class="price-slider">
                  <label class="price-label">{{ 'PRICE' | translate }}</label>
                  <mat-slider class="slider"
                              [min]="sliderMin"
                              [max]="sliderMax"
                              [step]="sliderStep"
                              thumbLabel
                              discrete
                              [ngClass]="getThemeClass()">
                    <input matSliderThumb
                           [(ngModel)]="newOrder.price"
                           name="priceSell"
                           required />
                  </mat-slider>

                  <div class="price-display">
                    <span [innerHTML]="formatPriceDisplay(newOrder.price)"></span>
                  </div>
                </div>
                }
              </div>

              <div class="form-column">
                <mat-form-field appearance="fill">
                  <mat-label>{{ 'AMOUNT' | translate }} ({{ 'VOLUME' | translate }})</mat-label>
                  <input matInput
                         type="text"
                         [ngModel]="volumeInput"
                         (ngModelChange)="onVolumeInput($event)"
                         (blur)="formatVolumeOnBlur()"
                         name="volumeBuy"
                         required
                         placeholder="0.00" />

                  <mat-hint align="end">{{ 'MINIMUN' | translate }}: {{ minVolume | number:'1.2-4' }}</mat-hint>

                  @if (sellForm.controls['volumeSell']?.hasError('required')) {
                  <mat-error>La cantidad es obligatoria</mat-error>
                  }
                  @if (sellForm.controls['volumeSell']?.hasError('min')) {
                  <mat-error>{{ 'MINIMUN' | translate }} {{ minVolume }}</mat-error>
                  }
                </mat-form-field>
              </div>
            </div>

            <button type="submit"
                    [disabled]="!sellForm.valid"
                    class="submit-btn submit-sell">
              {{ 'SELL' | translate }} {{ currentPair?.viewValue }}
            </button>

          </form>
        </div>
      </mat-tab>

    </mat-tab-group>
  </div>
  </div>
