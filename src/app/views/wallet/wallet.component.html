<div class="wallets-container">
  <header class="wallets-header">
    <h1>{{ 'WALLETS' | translate }}</h1>
    <button mat-raised-button color="primary" (click)="navigateToNewWallet()">
      <mat-icon>add</mat-icon>
      {{ 'CREATE_WALLET' | translate }}
    </button>
  </header>
  @if (wallets().length === 0) {
  <!-- Empty State -->
  <div class="empty-state">
    <mat-icon class="empty-icon">account_balance_wallet</mat-icon>
    <h3>No se encontraron billeteras</h3>
    <p>Get started by creating your first wallet</p>
    <button mat-raised-button color="primary" (click)="navigateToNewWallet()">
      <mat-icon>add</mat-icon>
      {{ 'CREATE_WALLET' | translate }}
    </button>
  </div>
  } @else {
  <!-- Wallets Grid -->
  <div class="wallets-grid">
    @for (wallet of wallets(); track wallet.walletId) {
    <div class="wallet-card" [class]="'wallet-' + wallet.currencyCode?.toLowerCase()">
      <!-- Header: Currency Info -->
      <div class="wallet-header">
        <div class="currency-info">
          <div class="currency-icon">
            {{ getCurrencySymbol(wallet.currencyCode) }}
          </div>
          <div>
            <h3>{{ wallet.currencyCode }}</h3>
            <p>{{ getCurrencyName(wallet.currencyCode) }}</p>
          </div>
        </div>
      </div>

      <!-- Balances -->
      <div class="wallet-balances">
        <!-- Total Balance -->
        <div class="balance-item">
          <div class="balance-label">
            <span>ðŸ’° {{ 'BALANCE' | translate }}</span>
          </div>
          <div class="balance-value">
            {{ wallet.balance | number:'1.2-2' }} {{ wallet.currencyCode }}
          </div>
          <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="calculateProgress(wallet)"></div>
          </div>
        </div>

        <!-- Available & Locked -->
        <div class="balance-details">
          <div class="balance-row">
            <span class="type-icon">âœ“</span>
            <span>{{ 'AVAILABLE' | translate }}</span>
            <strong class="available">
              {{ wallet.availableBalance | number:'1.2-2' }} {{ wallet.currencyCode }}
            </strong>
          </div>
          <div class="balance-row">
            <span class="type-icon">ðŸ”’</span>
            <span>{{ 'RESERVED' | translate }}</span>
            <strong class="locked">
              {{ wallet.lockedBalance | number:'1.2-2' }} {{ wallet.currencyCode }}
            </strong>
          </div>
        </div>
      </div>

      <!-- Actions -->
      <div class="wallet-footer">
        <button mat-stroked-button
                class="action-btn"
                [matMenuTriggerFor]="menuDepositMethods">
          <mat-icon>arrow_upward</mat-icon>
          {{ 'DEPOSIT' | translate }}
        </button>

        <button mat-stroked-button
                [matMenuTriggerFor]="menuWithdrawMethods"
                class="action-btn"
                [disabled]="wallet.availableBalance <= 0">
          <mat-icon>arrow_downward</mat-icon>
          {{ 'WITHDRAW' | translate }}
        </button>

        <button mat-icon-button [matMenuTriggerFor]="menu">
          <mat-icon>more_vert</mat-icon>
        </button>
      </div>

      <mat-menu #menuDepositMethods="matMenu">
        <button mat-menu-item (click)="processTransaction(wallet, 'DEPOSIT', 'CASH')">
          <mat-icon>money</mat-icon>
          {{ 'CASH' | translate }}
        </button>
        <button mat-menu-item (click)="processTransaction(wallet, 'DEPOSIT', 'CARD')">
          <mat-icon>credit_card</mat-icon>
          {{ 'CARD' | translate }}
        </button>
      </mat-menu>

      <mat-menu #menuWithdrawMethods="matMenu">
        <button mat-menu-item (click)="processTransaction(wallet, 'WITHDRAWAL', 'CASH')">
          <mat-icon>money</mat-icon>
          {{ 'CASH' | translate }}
        </button>
        <button mat-menu-item (click)="processTransaction(wallet, 'WITHDRAWAL', 'CARD')">
          <mat-icon>credit_card</mat-icon>
          {{ 'CARD' | translate }}
        </button>
      </mat-menu>

      <!-- More Menu -->
      <mat-menu #menu="matMenu">
        <button mat-menu-item>
          <mat-icon>receipt</mat-icon>
          {{ 'TRANSACTIONS' | translate }}
        </button>
        <button mat-menu-item>
          <mat-icon>info</mat-icon>
          {{ 'DETAILS' | translate }}
        </button>
      </mat-menu>
    </div>
    }
  </div>
  }
</div>
